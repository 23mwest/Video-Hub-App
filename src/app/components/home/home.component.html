<div class="window">

  <div class="titleBar">
    <div class="draggable">
      Video Hub
    </div>
    <div (click)="initiateClose()" class="closeButton">
      <span class="icon icon-cancel"></span>
    </div>
  </div>

  <!-- [ngStyle]="{ display: appState.topHidden ? 'none' : initial }" -->
  <header
    *ngIf="!appState.topHidden"
    class="top"
  >

    <div *ngIf="importDone; else progressBar">
      <app-top-component
        class="top-content-position"
        [fileString]="currentPlayingFile"
        [folderString]="currentPlayingFolder"
        (onFileWordClicked)="handleFileWordClicked($event)"
        (onFolderWordClicked)="handleFolderWordClicked($event)"
      ></app-top-component>
    </div>

    <ng-template #progressBar>
      <div *ngIf="progressPercent !== 0" class="progress-container">
        <div class="current-progress" [ngStyle]="{width: progressPercent * 100 + '%'}"></div>
      </div>
    </ng-template>

  </header>

  <div
    class="window-content"
    [ngStyle]="{
      transition: '300ms',
      transform: appState.menuHidden ? 'translate(0, -32px)' : 'translate(0, 0)'
    }"
  >

    <div
      [ngClass]="{ allSettingsExpanded: !appState.buttonsInView }"
      class="allSettings"
    >

      <!-- GEAR BUTTON -->
      <!-- <div class="gearButtonContainer"> -->
      <div
        (click)="rotateSettings()"
        [ngClass]="{ gearButtonActive: appState.buttonsInView }"
        class="gearButton"
      >
          <span class="icon icon-cog"></span>
      </div>
      <!-- </div> -->

      <!-- SEARCH BUTTONS-->
      <div
        [ngClass]="{ searchSettingsRotated: !appState.buttonsInView }"
        class="searchSettingsButtons"
      >
        <ng-container
          *ngFor="let button of searchButtons; index as i"
        >
          <button
            *ngIf="!button.hidden || !appState.buttonsInView"
            (click)="toggleSearchButton(i)"
            [ngClass]="{ active: button.toggled, buttonRightSideUp: !appState.buttonsInView, buttonOpacityLower: button.hidden }"
            title="{{ button.title }}"
          >
            <span class="icon {{ button.iconName }}"></span>
          </button>
        </ng-container>
      </div>

      <!-- Search buttons settings -->

      <div
        [ngClass]="{ searchButtonsSettingsInView: !appState.buttonsInView }"
        class="searchButtonsSettings"
      >
        <div class="showButtonLabel">show button in menu</div>
        <div
          *ngFor="let button of searchButtons; index as i"
          [ngClass]="{ buttonOpacityLower: button.hidden }"
          class="buttonDescription"
        >
          <input
            (change)="filterInputBoxClicked(i)"
            [checked]="!button.hidden"
            [ngClass]="{ inputCheckboxDisabled: button.hidden }"
            id="{{ button.uniqueKey }}"
            class="inputCheckbox"
            type="checkbox"
          >
          <label for="{{ button.uniqueKey }}" class="buttonDescriptionText">{{ button.description }}</label>
        </div>
      </div>

      <!-- GALLERY BUTTONS -->
      <div
        [ngClass]="{ gallerySettingsRotated: !appState.buttonsInView }"
        class="gallerySettingsButtons"
      >
        <ng-container
          *ngFor="let button of galleryButtons; index as i"
        >
          <button
            *ngIf="!button.hidden || !appState.buttonsInView"
            (click)="toggleGalleryButton(i)"
            [ngClass]="{ active: button.toggled, buttonRightSideUp: !appState.buttonsInView, buttonOpacityLower: button.hidden }"
            title="{{ button.title }}"
          >
            <span class="icon {{ button.iconName }}"></span>
          </button>
          <ng-container *ngIf="button.spaceAfter">
            <div
              [ngClass]="{ buttonSpacerExpanded: !appState.buttonsInView }"
              class="buttonSpacer"
            >
            </div>
          </ng-container>
        </ng-container>

      </div>

      <!-- Gallery buttons settings -->

      <div
        [ngClass]="{ galleryButtonsSettingsInView: !appState.buttonsInView }"
        class="galleryButtonsSettings"
      >
        <div class="showButtonLabel">show button in menu</div>
        <div
          *ngFor="let button of galleryButtons; index as i"
          class="buttonDescription"
          [ngClass]="{ buttonOpacityLower: button.hidden }"
          [ngStyle]="{ 'min-height': button.spaceAfter ? '82px' : '41px' }"
        >
          <input
            (change)="galleryInputBoxClicked(i)"
            [checked]="!button.hidden"
            [ngClass]="{ inputCheckboxDisabled: button.hidden }"
            id="{{ button.uniqueKey }}"
            class="inputCheckbox"
            type="checkbox"
          >
          <label 
            for="{{ button.uniqueKey }}"
            class="buttonDescriptionText buttonDescriptionTextGallery"
          >
            {{ button.description }}
          </label>
        </div>
      </div>

      <div
        class="extraSettings"
      >
        <input
          (change)="toggleTopVisible()"
          [checked]="!appState.topHidden"
          [ngClass]="{ inputCheckboxDisabled: !appState.topHidden }"
          id="hideTopBar"
          class="inputCheckbox"
          type="checkbox"
        >
        <label for="hideTopBar" class="extraSettingsText">
          Show the top bar.
          <br>
          <em>
            It shows the folder path and file name, each of which is clickable for quick searching.
          </em>
        </label>
      </div>

      <!-- VERTICAL DIVIDER -->
      <div
        [ngClass]="{ verticalDividerInView: !appState.buttonsInView }"
        class="verticalDivider"
      >
      </div>

    </div>

    <div (click)="toggleSettingsMenu()" [ngClass]="{ flipped: !appState.menuHidden }" class="hidingSettingsMenu">
      <span class="icon icon-down-open-mini"></span>
    </div>

    <div
      [ngClass]="{ 'sidebar-hidden': searchButtons[6].toggled }"
      class="sidebar"
    >

      <div class="filteringTotal">
        42 folders<br>
        2,493 videos
      </div>

      <!-- SEARCH BOXES -->
      <ng-container *ngFor="let filter of filters; index as j">
        <ng-container *ngIf="searchButtons[j].toggled">

          <input
            (keyup.enter)="onEnterKey(filter.string, j)"
            (keydown.backspace)="onBackspace(filter.string, j)"
            (keydown.escape)="filter.string = ''"
            [(ngModel)]="filter.string"
            class="inputFilter"
            placeholder="{{ filter.placeholder }}"
            type="text"
          >

          <div class="filteredWords">
            <ng-container *ngIf="filter.array.length > 0">
              <ng-container
                *ngFor="let string of filter.array; index as i"
              >
                <span class="conjunction" *ngIf="i > 0">
                  {{ filter.conjunction }}
                </span>
                <span (click)="removeThisFilter(i, j)" class="searchWord">
                  {{ string }}
                </span>
              </ng-container>
            </ng-container>
          </div>

        </ng-container>
      </ng-container>

      <!-- magic search and exclude fields -->
      <ng-container *ngIf="searchButtons[4].toggled">
        <input
          (keydown.escape)="magicSearchString = ''"
          [(ngModel)]="magicSearchString"
          type="text"
          class="inputFilter"
          placeholder="Folder or file contains"
        >

        <div
          class="filteredWords"
        >
          <!-- <span
            class="icon icon-record"
            style="color: #fc605b; margin-right: 5px;"
          ></span> -->
          <span
            *ngIf="magicSearchString !== ''"
            (click)="magicSearchString = ''"
            class="searchWord"
          >
            {{ magicSearchString }}
          </span>
        </div>
      </ng-container>
      <!-- END OF MAGIC SEARCH & exclude fields -->

      <div class="filteringTotal">
        <span>{{ currResults.total }} found</span>
      </div>

      <div *ngIf="searchButtons[5].toggled" class="frequency">
        <ng-container *ngFor="let word of wordFreqArr; index as i">
          <span
            [ngStyle]="{'font-size': word.height + 'px' }"
            (click)="handleFileWordClicked(word.word)"
          >
            {{ word.word }}
          </span>
        </ng-container>
      </div>

    </div> <!-- closing the SIDEBAR -->

<!-- THE GALLERY PANE -->

    <div
      [ngClass]="{ 'gallery-container-full-width': searchButtons[6].toggled}"
      class="gallery-container"
    >

<!-- GALLERY CODE -->

      <div 
        [ngClass]="{ filmOverride: appState.currentView !== 'thumbs' }"
        class="gallery" 
      >

        <!-- <virtual-scroll
                [items]="finalArray"
                [bufferAmount]="5"
                [childWidth]="100"
                [childHeight]="100"
                (update)="viewPortItems = $event"
              > -->

        <div
          class="item"
          [ngClass]="{
              fileNamePadding: !showMoreInfo && appState.currentView != 'files',
              filesView: appState.currentView === 'files',
              whenFilenamesHidden: appState.currentView === 'filmstrip' && !showMoreInfo,
              'item-big': previewSize,
              'large-filmstrip': appState.currentView === 'filmstrip' && previewSize
            }"
          *ngFor="let item of finalArray
                    | magicSearchPipe: magicSearchString
                    | fileSearchPipe: filters[0].array : filters[0].bool : true  : false
                    | fileSearchPipe: filters[1].array : filters[1].bool : false : false
                    | fileSearchPipe: filters[2].array : filters[2].bool : true  : true
                    | fileSearchPipe: filters[3].array : filters[3].bool : false : true
                    | wordFrequencyPipe: true
                    | limitPipe: appState.numberToShow;
                    index as i"
        >

          <div *ngIf="appState.currentView === 'thumbs'">

            <app-gallery-item
              (click)="openVideo(item[3])"
              [stuff]="item[3]"
              [folderPath]="appState.selectedOutputFolder"
              [largerSize]="previewSize"
              [hoverDisabled]="hoverDisabled"
              [randomImage]="randomImage"
            ></app-gallery-item>

          </div>

          <div *ngIf="appState.currentView === 'filmstrip'">

            <app-filmstrip-item
              (click)="openVideo(item[3])"
              [stuff]="item[3]"
              [folderPath]="appState.selectedOutputFolder"
              [width]="previewSize ? (2 * item[6] || 342) : (item[6] || 171)"
              [largerSize]="previewSize"
              [hoverDisabled]="hoverDisabled"
            ></app-filmstrip-item>

          </div>

          <div *ngIf="appState.currentView === 'files' && showMoreInfo">
            <div class="folder" *ngIf="true | folderViewPipe: item[0]">
              <span class="icon icon-folder"></span><span [innerHtml]="item[0] | folderArrowsPipe"></span>
            </div>
          </div>

          <div 
            *ngIf="showMoreInfo || appState.currentView === 'files'"
            class="metadata" 
          >

            <div 
              *ngIf="showMoreInfo"
              class="length" 
            >
              {{ item[4] | lengthPipe }}
            </div>

            <div 
              *ngIf="showMoreInfo"
              class="size" 
            >
              {{ item[5] }}
            </div>

            <div 
              (click)="openVideo(item[3])"
              [ngClass]="{ 'larger-font': previewSize }"
              class="title" 
            >
              {{ item[2] }}
            </div>

          </div>

        </div>

        <!-- </virtual-scroll> -->

      </div> <!-- end of gallery -->

    </div> <!-- end of gallery-container -->

  </div> <!-- end of window-content -->

</div> <!-- end of window -->

<!-- WIZARD -->

<div *ngIf="!importDone" class="wizard">

  <div [ngClass]="{ 'disabled-overlay': inProgress }"></div>

  <div class="left-side">

    <h1>Open previous hub</h1>

    <button (click)="loadFromFile()">
      Load from file
    </button>

  </div>

  <div class="right-side">

    <h1>Import new hub</h1>

    <div
      [ngClass]="{ 'current-step': appState.selectedSourceFolder === '' }"
      class="steps" 
    >
      1
    </div>
    <button (click)="selectSourceDirectory()">
      {{ appState.selectedSourceFolder === '' ? 'Select' : 'Change' }} input directory
    </button>
    
    <span class="description">
      Importing from:
    </span>
    <span class="path">
      {{ appState.selectedSourceFolder }}
    </span>
    
    <div 
      [ngClass]="{ 'current-step': appState.selectedSourceFolder !== '' && appState.selectedOutputFolder === '' }"
      class="steps"
    >
      2
    </div>
    <button 
      (click)="selectOutputDirectory()"
      [disabled]="appState.selectedSourceFolder === ''"
    >
      {{ appState.selectedOutputFolder === '' ? 'Select' : 'Change' }} output directory
    </button>
    
    <span class="description">
      Saving screenshots to:
    </span>
    <span class="path">
      {{ appState.selectedOutputFolder }}
    </span>
    
    <div 
      [ngClass]="{ 'current-step': appState.selectedOutputFolder !== '' && appState.selectedSourceFolder !== '' }"
      class="steps"
    >
      3
    </div>
    <button
      [disabled]="appState.selectedOutputFolder === '' || appState.selectedSourceFolder === ''"
      (click)="importFresh()"
    >
      Start the import
    </button>
  
  </div>

</div>
