<div class="window">

  <div class="titleBar">
    <div class="draggable">
      <img width="10px" height="10px" src="../../../assets/logo.png"> Video Hub
    </div>
    <div (click)="initiateMinimize()" class="winBtn minimizeButton">
      <span class="icon icon-minus"></span>
    </div>
    <div (click)="initiateMaximize()" class="winBtn maximizeButton">
      <span class="icon icon-maximize"></span>
    </div>
    <div (click)="initiateClose()" class="winBtn closeButton">
      <span class="icon icon-close"></span>
    </div>
  </div>

  <!-- SETTINGS / OPTIONS MODAL -->
  <div
    *ngIf="appState.buttonsInView"
    class="settingsModal"
    @myAnimation
  >

    <div
      (click)="toggleSettings()"
      class="closeSettings"
    >
      <span class="icon icon-close"></span>
    </div>


    <ng-container
      *ngFor="let btnGroup of settingsButtonsGroups; index as i"
    >

      <div *ngIf="i !== 0 && settingsCategories[i] !== ''" class="horizontalDivider">
      </div>
      <h2>{{ settingsCategories[i] }}</h2>

      <div
        class="searchButtonsSettings"
      >

        <div
          *ngFor="let buttonKey of btnGroup"
          [ngClass]="{ buttonOpacityLower: settingsButtons[buttonKey].hidden }"
          class="buttonDescription"
        >
          <button
            (click)="toggleButton(buttonKey)"
            [ngClass]="{
                buttonOpacityLower: settingsButtons[buttonKey].hidden,
                defaultSettingsButton:        settingsButtons['flatIcons'].toggled === false,
                defaultSettingsButtonToggled: settingsButtons['flatIcons'].toggled === false && settingsButtons[buttonKey].toggled,
                flatSettingsButton:           settingsButtons['flatIcons'].toggled === true,
                flatSettingsButtonToggled:    settingsButtons['flatIcons'].toggled === true && settingsButtons[buttonKey].toggled
              }"
            title="{{ settingsButtons[buttonKey].title }}"
          >
            <span class="icon {{ settingsButtons[buttonKey].iconName }}"></span>
          </button>

          <span
            *ngIf="settingsButtons[buttonKey].iconName !== 'icon-checkmark'"
            (click)="toggleHideButton(buttonKey)"
            class="eyeIconContainer icon {{ settingsButtons[buttonKey].hidden ? 'eye-closed' : 'eye-open' }}"
          ></span>

          <span
            class="buttonDescriptionText"
          >
            {{ settingsButtons[buttonKey].description }}
          </span>

        </div>
      </div>

    </ng-container>

  </div> <!-- END OF SETTINGS -->

  <header
    *ngIf="!settingsButtons['hideTop'].toggled"
    class="top"
  >

    <div>
      <app-top-component
        class="top-content-position"
        [fileString]="currentPlayingFile"
        [folderString]="currentPlayingFolder"
        (onFileWordClicked)="handleFileWordClicked($event)"
        (onFolderWordClicked)="handleFolderWordClicked($event)"
      ></app-top-component>
    </div>
  </header>

  <div
    class="window-content"
    [ngStyle]="{
      transition: '300ms',
      transform: appState.menuHidden ? 'translate(0, -32px)' : 'translate(0, 0)'
    }"
  >

    <div
      class="allSettings"
    >

      <!-- ALL THE BUTTONS-->
      <ng-container *ngFor="let btnGroup of settingsButtonsGroups; index as i">
        <div
          class="searchSettingsButtons"
        ><ng-container
            *ngFor="let buttonKey of btnGroup"
          ><!--
          --><button
              *ngIf="!settingsButtons[buttonKey].hidden && settingsButtons[buttonKey].iconName !== 'icon-checkmark'"
              (click)="toggleButton(buttonKey)"
              [ngClass]="{
                  defaultSettingsButton:        settingsButtons['flatIcons'].toggled === false,
                  defaultSettingsButtonToggled: settingsButtons['flatIcons'].toggled === false && settingsButtons[buttonKey].toggled,
                  flatSettingsButton:           settingsButtons['flatIcons'].toggled === true,
                  flatSettingsButtonToggled:    settingsButtons['flatIcons'].toggled === true && settingsButtons[buttonKey].toggled
                }"
              title="{{ settingsButtons[buttonKey].title }}"
            >
              <span class="icon {{ settingsButtons[buttonKey].iconName }}"></span>
            </button><!--
        --></ng-container><!--
        --><!--
      --></div>
      </ng-container>

      <!-- GEAR BUTTON -->
      <div
        (click)="toggleSettings()"
        [ngClass]="{ gearButtonActive: appState.buttonsInView }"
        class="gearButton"
      >
        <span class="icon icon-gear"></span>
      </div>

    </div>

    <div (click)="toggleSettingsMenu()" [ngClass]="{ flipped: !appState.menuHidden }" class="hidingSettingsMenu">
      <span class="icon icon-chevron-down-mini"></span>
    </div>

    <div
      [ngClass]="{ 'sidebar-hidden': settingsButtons['hideSidebar'].toggled }"
      [ngStyle]="{ 'background': settingsButtons['darkMode'].toggled ? '#444444' : '#d8d8d8' }"
      class="sidebar"
    >

      <div class="filteringTotal">
        {{ appState.numOfFolders | number }} folders<br>
        {{ finalArray.length | number }} videos
      </div>

      <!-- SEARCH BOXES -->
      <ng-container *ngFor="let filter of filters; index as j">
        <ng-container *ngIf="settingsButtons[filter.uniqueKey].toggled">

          <span class="icon input-icon {{ settingsButtons[filter.uniqueKey].iconName }}"></span>
          <input
            (keyup.enter)="onEnterKey(filter.string, j)"
            (keydown.backspace)="onBackspace(filter.string, j)"
            (keydown.escape)="filter.string = ''"
            [(ngModel)]="filter.string"
            [ngStyle]="{ color: settingsButtons['darkMode'].toggled ? 'white' : 'black' }"
            class="inputFilter"
            placeholder="{{ filter.placeholder }}"
            type="text"
          >

          <div class="filteredWords">
            <ng-container *ngIf="filter.array.length > 0">
              <ng-container
                *ngFor="let string of filter.array; index as i"
              >
                <span class="conjunction" *ngIf="i > 0">
                  {{ filter.conjunction }}
                </span>
                <span
                  (click)="removeThisFilter(i, j)"
                  [ngStyle]="{ background: filter.color }"
                  class="searchWord"
                >
                  {{ string }}
                </span>
              </ng-container>
            </ng-container>
          </div>

        </ng-container>
      </ng-container>

      <!-- magic search -->
      <ng-container *ngIf="settingsButtons['magic'].toggled">
        <span class="icon input-icon {{ settingsButtons['magic'].iconName }}"></span>
        <input
          (keydown.escape)="magicSearchString = ''"
          [(ngModel)]="magicSearchString"
          [ngStyle]="{ color: settingsButtons['darkMode'].toggled ? 'white' : 'black' }"
          type="text"
          class="inputFilter"
          placeholder="Folder or file contains"
        >

        <div
          class="filteredWords"
        >
          <!-- <span
            class="icon icon-record"
            style="color: #fc605b; margin-right: 5px;"
          ></span> -->
          <span
            *ngIf="magicSearchString !== ''"
            (click)="magicSearchString = ''"
            [ngStyle]="{ background: '#aaffaa' }"
            class="searchWord"
          >
            {{ magicSearchString }}
          </span>
        </div>
      </ng-container>

      <!-- total found -->
      <div class="filteringTotal">
        <span>Showing {{ numberToShow }} / {{ currResults.total }} found</span>
      </div>

      <!-- word cloud -->
      <div *ngIf="settingsButtons['showFreq'].toggled" class="frequency">
        <ng-container *ngFor="let word of wordFreqArr; index as i">
          <span
            [ngStyle]="{'font-size': word.height + 'px' }"
            (click)="handleFileWordClicked(word.word)"
          >
            {{ word.word }}
          </span>
        </ng-container>
      </div>

    </div> <!-- closing the SIDEBAR -->

<!-- THE GALLERY PANE -->

    <div
      [ngClass]="{ 'gallery-container-full-width': settingsButtons['hideSidebar'].toggled}"
      [ngStyle]="{ 'background': settingsButtons['darkMode'].toggled ? '#000000' : '#999999' }"
      (scroll)="scrollHandler($event)"
      class="gallery-container"
      #galleryArea
    >

<!-- GALLERY CODE -->

      <div
        [ngClass]="{ filmOverride: appState.currentView !== 'thumbs' }"
        class="gallery"
      >

        <div
          class="item"
          [ngClass]="{
              fileNamePadding: !settingsButtons['showMoreInfo'].toggled && appState.currentView != 'files',
              filesView: appState.currentView === 'files',
              whenFilenamesHidden: appState.currentView === 'filmstrip' && !settingsButtons['showMoreInfo'].toggled
            }"
          [ngStyle]="{
              height: imgHeight + 'px',
              'min-width': ((imgHeight / 100) * 174) + 'px',
              'max-width': (appState.currentView === 'thumbs') ? ((imgHeight / 100) * 174) + 'px' : 'calc(100vw - 240px)'
            }"
          *ngFor="let item of finalArray
                    | magicSearchPipe: magicSearchString
                    | fileSearchPipe: filters[0].array : filters[0].bool : true  : false : false
                    | fileSearchPipe: filters[1].array : filters[1].bool : false : false : false
                    | fileSearchPipe: filters[2].array : filters[2].bool : true  : true : false
                    | fileSearchPipe: filters[3].array : filters[3].bool : false : true : false
                    | fileSearchPipe: filters[4].array : filters[4].bool : true : true : true
                    | wordFrequencyPipe: true
                    | limitPipe: numberToShow;
                    index as i"
        >

          <div *ngIf="appState.currentView === 'thumbs'">

            <app-gallery-item
              (click)="openVideo(i)"
              [stuff]="item[3]"
              [folderPath]="appState.selectedOutputFolder"
              [imgHeight]="imgHeight"
              [hoverScrub]="settingsButtons['hoverScrub'].toggled"
              [randomImage]="settingsButtons['randomImage'].toggled"
            ></app-gallery-item>

          </div>

          <div *ngIf="appState.currentView === 'filmstrip'">

            <app-filmstrip-item
              (click)="openVideo(i)"
              [stuff]="item[3]"
              [folderPath]="appState.selectedOutputFolder"
              [width]="(imgHeight / 100) * item[6] || (imgHeight / 100) * 171"
              [imgHeight]="imgHeight"
              [hoverScrub]="settingsButtons['hoverScrub'].toggled"
            ></app-filmstrip-item>

          </div>

          <div *ngIf="appState.currentView === 'files' && settingsButtons['showMoreInfo'].toggled">
            <div class="folder" *ngIf="true | folderViewPipe: item[0]">
              <span class="icon icon-folder-blank"></span><span [innerHtml]="item[0] | folderArrowsPipe"></span>
            </div>
          </div>

          <div
            *ngIf="settingsButtons['showMoreInfo'].toggled || appState.currentView === 'files'"
            class="metadata"
          >

            <div
              *ngIf="settingsButtons['showMoreInfo'].toggled"
              class="length"
            >
              {{ item[4] | lengthPipe }}
            </div>

            <div
              *ngIf="settingsButtons['showMoreInfo'].toggled"
              class="size"
            >
              {{ item[5] }}
            </div>

            <div
              (click)="openVideo(i)"
              [ngClass]="{ 'larger-font': settingsButtons['fontSizeLarger'].toggled }"
              class="title"
            >
              {{ item[2] }}
            </div>

          </div>

        </div>

      </div> <!-- end of gallery -->

    </div> <!-- end of gallery-container -->

  </div> <!-- end of window-content -->

</div> <!-- end of window -->

<!-- IMPORT MODAL  -->

<div 
  *ngIf="!importDone && progressPercent !== 0" 
  class="progress-modal"
  @myAnimation
>
  <div class="progress-container">
    <div class="current-progress" [ngStyle]="{width: progressPercent * 100 + '%'}"></div>
  </div>
  <div class="progress-numbers">
    {{ progressNum1 }} / {{ progressNum2 }}
  </div>
</div>

<div [ngClass]="{ 'disabled-overlay': inProgress }"></div>

<!-- WIZARD -->

<div *ngIf="showWizard" class="wizard">
  <div class="left-side">

    <h2>Open previous hub</h2>

    <button (click)="loadFromFile()">
      Load from file
    </button>

  </div>

  <div class="right-side">

    <h2>Import new hub</h2>

    <div
      [ngClass]="{ 'current-step': appState.selectedSourceFolder === '' }"
      class="steps"
    >
      1
    </div>
    <button (click)="selectSourceDirectory()">
      {{ appState.selectedSourceFolder === '' ? 'Select' : 'Change' }} input directory
    </button>

    <span class="description">
      Importing from:
    </span>
    <span class="path">
      {{ appState.selectedSourceFolder }}
    </span>

    <div
      [ngClass]="{ 'current-step': appState.selectedSourceFolder !== '' && appState.selectedOutputFolder === '' }"
      class="steps"
    >
      2
    </div>
    <button
      (click)="selectOutputDirectory()"
      [disabled]="appState.selectedSourceFolder === ''"
    >
      {{ appState.selectedOutputFolder === '' ? 'Select' : 'Change' }} output directory
    </button>

    <span class="description">
      Saving screenshots to:
    </span>
    <span class="path">
      {{ appState.selectedOutputFolder }}
    </span>

    <div
      [ngClass]="{ 'current-step': appState.selectedOutputFolder !== '' && appState.selectedSourceFolder !== '' }"
      class="steps"
    >
      3
    </div>
    
    <select (change)="selectScreenshotSize($event.target.value)" class="size-dropdown">
      <option value="50">50px</option>
      <option value="75">75px</option>
      <option value="100" selected="selected">100px</option>
      <option value="150">150px</option>
      <option value="200">200px</option>
      <option value="250">250px</option>
      <option value="300">300px</option>
    </select>

    <span class="description">
      Size of screenshots
    </span>

    <div
      [ngClass]="{ 'current-step': appState.selectedOutputFolder !== '' && appState.selectedSourceFolder !== '' }"
      class="steps"
    >
      4
    </div>
    <button
      [disabled]="appState.selectedOutputFolder === '' || appState.selectedSourceFolder === ''"
      (click)="importFresh()"
    >
      Start the import
    </button>

  </div>

</div>
