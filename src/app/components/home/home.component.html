<div class="window">

  <div class="titleBar">
    <div class="draggable">
      <img width="10px" height="10px" src="../../../assets/logo.png"> Video Hub
    </div>
    <div (click)="initiateMinimize()" class="winBtn minimizeButton">
      <span class="icon icon-minus"></span>
    </div>
    <div (click)="initiateMaximize()" class="winBtn maximizeButton">
      <span class="icon icon-doc-landscape"></span>
    </div>
    <div (click)="initiateClose()" class="winBtn closeButton">
      <span class="icon icon-cancel"></span>
    </div>
  </div>

  <!-- SETTINGS -->
  <div
    *ngIf="settingsNowShown"
    [ngClass]="{ allSettingsExpanded: !appState.buttonsInView }"
    class="allSettings2"
  >

    <div
      (click)="toggleSettings()"
      [ngClass]="{ closeSettingsHidden: appState.buttonsInView }"
      class="closeSettings"
    >
      <span class="icon icon-cancel"></span>
    </div>

    <h2>Search & filter settings</h2>

    <div
      [ngClass]="{ searchButtonsSettingsInView: !appState.buttonsInView }"
      class="searchButtonsSettings"
    >

      <div
        *ngFor="let button of searchButtons; index as i"
        [ngClass]="{ buttonOpacityLower: button.hidden }"
        class="buttonDescription"
      >
        <button
          (click)="toggleSearchButton(i)"
          [ngClass]="{ active: button.toggled, buttonOpacityLower: button.hidden }"
          title="{{ button.title }}"
        >
          <span class="icon {{ button.iconName }}"></span>
        </button>

        <input
          (change)="filterInputBoxClicked(i)"
          [checked]="!button.hidden"
          [ngClass]="{ inputCheckboxDisabled: button.hidden }"
          id="{{ button.uniqueKey }}"
          class="inputCheckbox"
          type="checkbox"
        >
        <label for="{{ button.uniqueKey }}" class="buttonDescriptionText">{{ button.description }}</label>
      </div>
    </div>

    <div class="horizontalDivider">
    </div>

    <h2>Gallery & view settings</h2>

    <div
      [ngClass]="{ galleryButtonsSettingsInView: !appState.buttonsInView }"
      class="galleryButtonsSettings"
    >

      <div
        *ngFor="let button of galleryButtons; index as i"
        class="buttonDescription"
        [ngClass]="{ buttonOpacityLower: button.hidden }"
        [ngStyle]="{ 'min-height': button.spaceAfter ? '50px' : '40px' }"
      >
        <button
          *ngIf="!button.hidden || !appState.buttonsInView"
          (click)="toggleGalleryButton(i)"
          [ngClass]="{ active: button.toggled, buttonOpacityLower: button.hidden }"
          title="{{ button.title }}"
        >
          <span class="icon {{ button.iconName }}"></span>
        </button>

        <input
          (change)="galleryInputBoxClicked(i)"
          [checked]="!button.hidden"
          [ngClass]="{ inputCheckboxDisabled: button.hidden }"
          id="{{ button.uniqueKey }}"
          class="inputCheckbox"
          type="checkbox"
        >
        <label
          for="{{ button.uniqueKey }}"
          class="buttonDescriptionText buttonDescriptionTextGallery"
        >
          {{ button.description }}
        </label>
      </div>
    </div>

    <div class="horizontalDivider">
    </div>

    <h2>Other settings</h2>

    <div
      class="extraSettings"
    >
      <input
        (change)="toggleTopVisible()"
        [checked]="!appState.topHidden"
        [ngClass]="{ inputCheckboxDisabled: !appState.topHidden }"
        id="hideTopBar"
        class="inputCheckbox"
        type="checkbox"
      >
      <label for="hideTopBar" class="extraSettingsText">
        Show the top bar.
        <br>
        <em>
          It shows the folder path and file name, each of which is clickable for quick searching.
        </em>
      </label>
    </div>

  </div>

  <!-- [ngStyle]="{ display: appState.topHidden ? 'none' : initial }" -->
  <header
    *ngIf="!appState.topHidden"
    class="top"
  >

    <div *ngIf="importDone; else progressBar">
      <app-top-component
        class="top-content-position"
        [fileString]="currentPlayingFile"
        [folderString]="currentPlayingFolder"
        (onFileWordClicked)="handleFileWordClicked($event)"
        (onFolderWordClicked)="handleFolderWordClicked($event)"
      ></app-top-component>
    </div>

    <ng-template #progressBar>
      <div *ngIf="progressPercent !== 0" class="progress-container">
        <div class="current-progress" [ngStyle]="{width: progressPercent * 100 + '%'}"></div>
      </div>
    </ng-template>

  </header>

  <div
    class="window-content"
    [ngStyle]="{
      transition: '300ms',
      transform: appState.menuHidden ? 'translate(0, -32px)' : 'translate(0, 0)'
    }"
  >

    <div
      class="allSettings"
    >

      <!-- GEAR BUTTON -->
      <div
        (click)="toggleSettings()"
        [ngClass]="{ gearButtonActive: appState.buttonsInView }"
        class="gearButton"
      >
        <span class="icon icon-cog"></span>
      </div>

      <!-- SEARCH BUTTONS-->
      <div
        class="searchSettingsButtons"
      >
        <ng-container
          *ngFor="let button of searchButtons; index as i"
        >
          <button
            *ngIf="!button.hidden"
            (click)="toggleSearchButton(i)"
            [ngClass]="{ active: button.toggled }"
            title="{{ button.title }}"
          >
            <span class="icon {{ button.iconName }}"></span>
          </button>
        </ng-container>
      </div>

      <!-- GALLERY BUTTONS -->
      <div
        class="gallerySettingsButtons"
      >
        <ng-container
          *ngFor="let button of galleryButtons; index as i"
        >
          <button
            *ngIf="!button.hidden"
            (click)="toggleGalleryButton(i)"
            [ngClass]="{ active: button.toggled }"
            title="{{ button.title }}"
          >
            <span class="icon {{ button.iconName }}"></span>
          </button>
          <ng-container *ngIf="button.spaceAfter">
            <div
              class="buttonSpacer"
            >
            </div>
          </ng-container>
        </ng-container>

      </div>
    </div>

    <div (click)="toggleSettingsMenu()" [ngClass]="{ flipped: !appState.menuHidden }" class="hidingSettingsMenu">
      <span class="icon icon-down-open-mini"></span>
    </div>

    <div
      [ngClass]="{ 'sidebar-hidden': searchButtons[6].toggled }"
      class="sidebar"
    >

      <div class="filteringTotal">
        42 folders<br>
        2,493 videos
      </div>

      <!-- SEARCH BOXES -->
      <ng-container *ngFor="let filter of filters; index as j">
        <ng-container *ngIf="searchButtons[j].toggled">

          <input
            (keyup.enter)="onEnterKey(filter.string, j)"
            (keydown.backspace)="onBackspace(filter.string, j)"
            (keydown.escape)="filter.string = ''"
            [(ngModel)]="filter.string"
            class="inputFilter"
            placeholder="{{ filter.placeholder }}"
            type="text"
          >

          <div class="filteredWords">
            <ng-container *ngIf="filter.array.length > 0">
              <ng-container
                *ngFor="let string of filter.array; index as i"
              >
                <span class="conjunction" *ngIf="i > 0">
                  {{ filter.conjunction }}
                </span>
                <span
                  (click)="removeThisFilter(i, j)"
                  [ngStyle]="{ background: filter.color }"
                  class="searchWord"
                >
                  {{ string }}
                </span>
              </ng-container>
            </ng-container>
          </div>

        </ng-container>
      </ng-container>

      <!-- magic search and exclude fields -->
      <ng-container *ngIf="searchButtons[4].toggled">
        <input
          (keydown.escape)="magicSearchString = ''"
          [(ngModel)]="magicSearchString"
          type="text"
          class="inputFilter"
          placeholder="Folder or file contains"
        >

        <div
          class="filteredWords"
        >
          <!-- <span
            class="icon icon-record"
            style="color: #fc605b; margin-right: 5px;"
          ></span> -->
          <span
            *ngIf="magicSearchString !== ''"
            (click)="magicSearchString = ''"
            [ngStyle]="{ background: '#DD99DD' }"
            class="searchWord"
          >
            {{ magicSearchString }}
          </span>
        </div>
      </ng-container>
      <!-- END OF MAGIC SEARCH & exclude fields -->

      <div class="filteringTotal">
        <span>{{ currResults.total }} found</span>
      </div>

      <div *ngIf="searchButtons[5].toggled" class="frequency">
        <ng-container *ngFor="let word of wordFreqArr; index as i">
          <span
            [ngStyle]="{'font-size': word.height + 'px' }"
            (click)="handleFileWordClicked(word.word)"
          >
            {{ word.word }}
          </span>
        </ng-container>
      </div>

    </div> <!-- closing the SIDEBAR -->

<!-- THE GALLERY PANE -->

    <div
      [ngClass]="{ 'gallery-container-full-width': searchButtons[6].toggled}"
      [ngStyle]="{ 'background': galleryButtons[9].toggled ? '#000000' : '#999999' }"
      class="gallery-container"
    >

<!-- GALLERY CODE -->

      <div
        [ngClass]="{ filmOverride: appState.currentView !== 'thumbs' }"
        class="gallery"
      >

        <!-- <virtual-scroll
                [items]="finalArray"
                [bufferAmount]="5"
                [childWidth]="100"
                [childHeight]="100"
                (update)="viewPortItems = $event"
              > -->

        <div
          class="item"
          [ngClass]="{
              fileNamePadding: !showMoreInfo && appState.currentView != 'files',
              filesView: appState.currentView === 'files',
              whenFilenamesHidden: appState.currentView === 'filmstrip' && !showMoreInfo
            }"
          [ngStyle]="{
              height: imgHeight + 'px',
              'min-width': ((imgHeight / 100) * 174) + 'px',
              'max-width': (appState.currentView === 'thumbs') ? ((imgHeight / 100) * 174) + 'px' : 'calc(100vw - 240px)'
            }"
          *ngFor="let item of finalArray
                    | magicSearchPipe: magicSearchString
                    | fileSearchPipe: filters[0].array : filters[0].bool : true  : false
                    | fileSearchPipe: filters[1].array : filters[1].bool : false : false
                    | fileSearchPipe: filters[2].array : filters[2].bool : true  : true
                    | fileSearchPipe: filters[3].array : filters[3].bool : false : true
                    | wordFrequencyPipe: true
                    | limitPipe: appState.numberToShow;
                    index as i"
        >

          <div *ngIf="appState.currentView === 'thumbs'">

            <app-gallery-item
              (click)="openVideo(item[3])"
              [stuff]="item[3]"
              [folderPath]="appState.selectedOutputFolder"
              [imgHeight]="imgHeight"
              [hoverDisabled]="hoverDisabled"
              [randomImage]="randomImage"
            ></app-gallery-item>

          </div>

          <div *ngIf="appState.currentView === 'filmstrip'">

            <app-filmstrip-item
              (click)="openVideo(item[3])"
              [stuff]="item[3]"
              [folderPath]="appState.selectedOutputFolder"
              [width]="(imgHeight / 100) * item[6] || (imgHeight / 100) * 171"
              [imgHeight]="imgHeight"
              [hoverDisabled]="hoverDisabled"
            ></app-filmstrip-item>

          </div>

          <div *ngIf="appState.currentView === 'files' && showMoreInfo">
            <div class="folder" *ngIf="true | folderViewPipe: item[0]">
              <span class="icon icon-folder"></span><span [innerHtml]="item[0] | folderArrowsPipe"></span>
            </div>
          </div>

          <div
            *ngIf="showMoreInfo || appState.currentView === 'files'"
            class="metadata"
          >

            <div
              *ngIf="showMoreInfo"
              class="length"
            >
              {{ item[4] | lengthPipe }}
            </div>

            <div
              *ngIf="showMoreInfo"
              class="size"
            >
              {{ item[5] }}
            </div>

            <div
              (click)="openVideo(item[3])"
              [ngClass]="{ 'larger-font': previewSize }"
              class="title"
            >
              {{ item[2] }}
            </div>

          </div>

        </div>

        <!-- </virtual-scroll> -->

      </div> <!-- end of gallery -->

    </div> <!-- end of gallery-container -->

  </div> <!-- end of window-content -->

</div> <!-- end of window -->

<!-- WIZARD -->

<div *ngIf="!importDone" class="wizard">

  <div [ngClass]="{ 'disabled-overlay': inProgress }"></div>

  <div class="left-side">

    <h2>Open previous hub</h2>

    <button (click)="loadFromFile()">
      Load from file
    </button>

  </div>

  <div class="right-side">

    <h2>Import new hub</h2>

    <div
      [ngClass]="{ 'current-step': appState.selectedSourceFolder === '' }"
      class="steps"
    >
      1
    </div>
    <button (click)="selectSourceDirectory()">
      {{ appState.selectedSourceFolder === '' ? 'Select' : 'Change' }} input directory
    </button>

    <span class="description">
      Importing from:
    </span>
    <span class="path">
      {{ appState.selectedSourceFolder }}
    </span>

    <div
      [ngClass]="{ 'current-step': appState.selectedSourceFolder !== '' && appState.selectedOutputFolder === '' }"
      class="steps"
    >
      2
    </div>
    <button
      (click)="selectOutputDirectory()"
      [disabled]="appState.selectedSourceFolder === ''"
    >
      {{ appState.selectedOutputFolder === '' ? 'Select' : 'Change' }} output directory
    </button>

    <span class="description">
      Saving screenshots to:
    </span>
    <span class="path">
      {{ appState.selectedOutputFolder }}
    </span>

    <div
      [ngClass]="{ 'current-step': appState.selectedOutputFolder !== '' && appState.selectedSourceFolder !== '' }"
      class="steps"
    >
      3
    </div>
    <button
      [disabled]="appState.selectedOutputFolder === '' || appState.selectedSourceFolder === ''"
      (click)="importFresh()"
    >
      Start the import
    </button>

  </div>

</div>
