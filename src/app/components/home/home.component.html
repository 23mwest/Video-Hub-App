<div class="window">

  <header class="top toolbar toolbar-header">

    <div *ngIf="importDone; else progressBar">
      <app-top-component
        class="top-content-position"
        [fileString]="currentPlayingFile"
        [folderString]="currentPlayingFolder"
        (onFileWordClicked)="handleFileWordClicked($event)"
        (onFolderWordClicked)="handleFolderWordClicked($event)"
      ></app-top-component>
    </div>

    <ng-template #progressBar>
      <div *ngIf="progressPercent != 0" class="progress-container">
        <div class="current-progress" [ngStyle]="{width: progressPercent * 100 + '%'}"></div>
      </div>
    </ng-template>

  </header>


    <div class="window-content">
      <div class="pane-group">
        <div class="pane pane-sm sidebar">

<!-- SEARCH BUTTONS -->

          <div class="btn-group">
            <button
              *ngFor="let button of searchButtons; index as i"
              (click)="toggleSearchButton(i)"
              [ngClass]="{ active: button.toggled }"
              class="btn btn-mini btn-default"
              title="{{ button.title }}"
            >
              <span class="icon {{ button.iconName }}"></span>
            </button>
          </div>

<!-- SEARCH BOXES -->

          <nav class="nav-group">

            <ng-container *ngFor="let filter of filters; index as j">

              <ng-container *ngIf="searchButtons[j].toggled">

                <h5 class="nav-group-title">
                  <input
                    (keyup.enter)="onEnterKey(filter.string, j)"
                    (keyup.backspace)="onBackspace(j)"
                    [(ngModel)]="filter.string"
                    class="form-control"
                    placeholder={{filter.placeholder}}
                    type="text"
                  >
                </h5>

                <h5 class="nav-group-title">
                  <ng-container *ngFor="let string of filter.array; index as i">
                    <span class="conjunction" *ngIf="i > 0">
                      {{ filter.conjunction }}
                    </span>
                    <span (click)="removeThisFilter(i, j)" class="searchWord">
                      {{ string }}
                    </span>
                  </ng-container>
                </h5>

              </ng-container>

            </ng-container>

<!-- magic search and exclude search fields -->

            <ng-container *ngIf="searchButtons[4].toggled">

              <h5 class="nav-group-title">
                <input
                  [(ngModel)]="magicSearchString"
                  type="text"
                  class="form-control"
                  placeholder="Magic search"
                >
              </h5>

              <h5 class="nav-group-title">
                <span
                  class="icon icon-record"
                  style="color: #fc605b; margin-right: 5px;"
                ></span>
                Magic: {{ magicSearchString }}
              </h5>

            </ng-container>

          </nav>
        </div>

<!-- THE GALLERY PANE -->

        <div class="pane">

          <div class="gallery-container">

<!-- GALLERY BUTTONS -->

            <div
              [ngClass]="{settingsRotated: appState.buttonsInView}"
              class="gallerySettingsButtons"
            >

            <!-- toggle button that triggers the rotation - should be styled uniquely -->

              <div class="btn-group">
                <button
                  (click)="rotateSettings()"
                  [ngClass]="{active: appState.buttonsInView}"
                  class="btn btn-mini btn-default"
                >
                  <span class="icon icon-cog"></span>
                </button>
              </div>

              <!-- all the gallery buttons -->

              <div class="btn-group">

                <ng-container
                  *ngFor="let button of galleryButtons; index as i"
                >
                  <button
                    (click)="galleryButtonClicked(i)"
                    [ngClass]="{ active: button.toggled }"
                    class="btn btn-mini btn-default"
                    title="{{ button.title }}"
                  >
                    <span class="icon {{ button.iconName }}"></span>
                  </button>

                  <ng-container *ngIf="button.spaceAfter">
                    <div class="buttonSpacer"></div>
                  </ng-container>

                </ng-container>

              </div>

            </div>

<!-- GALLERY CODE -->

            <div class="gallery" [ngClass]="{filmOverride: appState.currentView !== 'thumbs'}">

              <!-- <virtual-scroll
                      [items]="finalArray"
                      [bufferAmount]="5"
                      [childWidth]="100"
                      [childHeight]="100"
                      (update)="viewPortItems = $event"
                    > -->

              <div
                class="item"
                [ngClass]="{
                    fileNamePadding: !showMoreInfo && appState.currentView != 'files',
                    filesView: appState.currentView === 'files',
                    whenFilenamesHidden: appState.currentView === 'filmstrip' && !showMoreInfo
                  }"
                *ngFor="let item of finalArray
                          | magicSearchPipe: magicSearchString
                          | fileSearchPipe: filters[0].array : filters[0].bool : true  : false
                          | fileSearchPipe: filters[1].array : filters[1].bool : false : false
                          | fileSearchPipe: filters[2].array : filters[2].bool : true  : true
                          | fileSearchPipe: filters[3].array : filters[3].bool : false : true
                          | limitPipe: appState.numberToShow;
                          index as i"
              >

                <div *ngIf="appState.currentView === 'thumbs'">

                  <app-gallery-item
                    (click)="openVideo(item[3])"
                    [stuff]="item[3]"
                    [folderPath]="appState.selectedOutputFolder"
                  ></app-gallery-item>

                </div>

                <div *ngIf="appState.currentView === 'filmstrip'">

                  <app-filmstrip-item
                    (click)="openVideo(item[3])"
                    [stuff]="item[3]"
                    [folderPath]="appState.selectedOutputFolder"
                    [width]="item[6] || 171"
                  ></app-filmstrip-item>

                </div>

                <div *ngIf="appState.currentView === 'files' && showMoreInfo">
                  <div class="folder" *ngIf="true | folderViewPipe: item[0]">
                    <span class="icon icon-folder"></span><span [innerHtml]="item[0] | folderArrowsPipe"></span>
                  </div>
                </div>

                <div class="metadata" *ngIf="showMoreInfo || appState.currentView === 'files'">

                  <div class="length" *ngIf="showMoreInfo">
                    {{ item[4] | lengthPipe }}
                  </div>

                  <div class="size" *ngIf="showMoreInfo">
                    {{ item[5] }}
                  </div>

                  <div class="title" (click)="openVideo(item[3])">
                    {{ item[2] }}
                  </div>

                </div>

              </div>

              <!-- </virtual-scroll> -->

            </div>

          </div>

        </div>
      </div>
    </div>
  </div>

<!-- WIZARD -->

  <div *ngIf="!importDone" class="wizard">

    <div [ngClass]="{'disabled-overlay': inProgress}"></div>

    <h3>Welcome to VideoHub</h3>

    <h5 class="nav-group-title">

      <button (click)="loadFromFile()" class="btn btn-mini btn-positive">
        Load from file
      </button>
    </h5>

    <h5 class="nav-group-title">or</h5>

    <h5 class="nav-group-title">
      <button (click)="selectSourceDirectory()" class="btn btn-mini btn-negative">
        Select input directory
      </button>
    </h5>

    <h5 class="nav-group-title">
      Source: {{ appState.selectedSourceFolder }}
    </h5>

    <h5 class="nav-group-title">
      <button (click)="selectOutputDirectory()" class="btn btn-mini btn-negative">
        Select output directory
      </button>
    </h5>

    <h5 class="nav-group-title">
      Output: {{ appState.selectedOutputFolder }}
    </h5>

    <h5 class="nav-group-title">
      <button
        [disabled]="appState.selectedOutputFolder === '' && appState.selectedSourceFolder === ''"
        (click)="importFresh()"
        class="btn btn-mini btn-positive"
      >
        Start the import
      </button>
    </h5>
  </div>

